"use strict";(self.webpackChunkwww_cloudcarbonfootprint_org=self.webpackChunkwww_cloudcarbonfootprint_org||[]).push([[487],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=o,h=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return n?r.createElement(h,i(i({ref:t},c),{},{components:n})):r.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7625:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={id:"performance-considerations",title:"Performance Considerations",slug:"/performance-considerations",sidebar_position:2},i=void 0,s={unversionedId:"ConfigurationOptions/performance-considerations",id:"ConfigurationOptions/performance-considerations",title:"Performance Considerations",description:"Options to Improve Query Performance",source:"@site/docs/ConfigurationOptions/PerformanceConsiderations.md",sourceDirName:"ConfigurationOptions",slug:"/performance-considerations",permalink:"/docs/performance-considerations",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"performance-considerations",title:"Performance Considerations",slug:"/performance-considerations",sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"Data Persistence and Caching",permalink:"/docs/data-persistence-and-caching"},next:{title:"Tagging",permalink:"/docs/tagging"}},l={},u=[{value:"Options to Improve Query Performance",id:"options-to-improve-query-performance",level:2},{value:"Date Range",id:"date-range",level:3},{value:"Group By Timestamp in Queries",id:"group-by-timestamp-in-queries",level:3},{value:"Azure Performance Considerations",id:"azure-performance-considerations",level:2},{value:"Rate Limit and Retry Logic",id:"rate-limit-and-retry-logic",level:3},{value:"Configuration Options",id:"configuration-options",level:3},{value:"Date Chunking",id:"date-chunking",level:4},{value:"Multiple Subscriptions",id:"multiple-subscriptions",level:5}],c={toc:u},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"options-to-improve-query-performance"},"Options to Improve Query Performance"),(0,o.kt)("p",null,"When running very large amounts of data with the default configuration of querying each day for the previous year, we have noticed that the time it takes to start the app increases significantly. We have added optional configuration to help with this performance issue to query and date filter in a few different ways:"),(0,o.kt)("h3",{id:"date-range"},"Date Range"),(0,o.kt)("p",null,"In your ",(0,o.kt)("inlineCode",{parentName:"p"},"packages/client/.env")," file, you can provide the following variables for a custom date range:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"REACT_APP_DATE_RANGE_TYPE")," (example values: day(s), week(s), month(s), etc..)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"REACT_APP_DATE_RANGE_VALUE")," (example values: number correlating to day/week/month etc..)")),(0,o.kt)("h3",{id:"group-by-timestamp-in-queries"},"Group By Timestamp in Queries"),(0,o.kt)("p",null,"In your ",(0,o.kt)("inlineCode",{parentName:"p"},"packages/client/.env")," file, you can provide the following variable for a custom query option to group the data by date type:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"REACT_APP_GROUP_BY")," (example values: day, week, month, quarter, year)")),(0,o.kt)("p",null,"Please Note:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Data grouped by time periods other than days will usually honor the time period of the grouping over a specific date range that falls within the range. For example, when data is grouped by month and the dates Oct. 18 - Nov. 12 are requested, the API and UI will return one data point for November that includes all available data for the month of November (1st - 30th). Behavior when requesting specific dates including portions of the group by period may not be consistent due to caching.")),(0,o.kt)("h2",{id:"azure-performance-considerations"},"Azure Performance Considerations"),(0,o.kt)("p",null,"When fetching usage data from Azure, we take a different approach from the other cloud providers in which we query the Consumption Management API in order to fetch usage data. This is because Azure currently does not provide a way to execute large SQL queries\nagainst an exported billing table. As a result, we query the UsageDetails endpoint of the ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/rest/api/consumption/"},"Azure Consumption API")," to gather usage data for each subscription in the provided account."),(0,o.kt)("h3",{id:"rate-limit-and-retry-logic"},"Rate Limit and Retry Logic"),(0,o.kt)("p",null,"Due to the required frequency for fetching this amount of data from the API, requests may be subject to API throttling and rate limiting. We have added some logic to help with this issue, but it is important to note that the more subscriptions you have in your Azure account, the more requests will be made to the API and the more likely you are to encounter rate limit warnings."),(0,o.kt)("p",null,"In the chance of exceeding rate limits, we have implemented retry logic for each subscription in which we wait the required amount of time specified in the response error before retrying the request again (usually 60 seconds). When this issue is encountered, you will see the following warning logged in the console:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-zsh"},"[ConsumptionManagement] warn: Azure ConsumptionManagementClient UsageDetailRow paging for time range [startDate] to [endDate] failed. Reason: Too many requests. Please retry after 60 seconds.\n")),(0,o.kt)("p",null,"In this instance, no action is needed and usage data will be fetched after the retry period has passed. However, each subscription can only attempt a ",(0,o.kt)("em",{parentName:"p"},"maximum of 10 retries")," before it will be skipped and excluded from the calculated estimates. When this occurs, a relevant warning will be logged to the console with details on which subscription was affected. If you encounter this issue, we recommend making a separate request for the affected subscription(s) or to explore one of the configuration options below to reduce the scope of the request."),(0,o.kt)("h3",{id:"configuration-options"},"Configuration Options"),(0,o.kt)("h4",{id:"date-chunking"},"Date Chunking"),(0,o.kt)("p",null,"To aid the frequency of encountered rate limits for a ",(0,o.kt)("em",{parentName:"p"},"single")," subscription, you can split the date range for the requests into smaller chunks. To enable this feature, we've added a configuration option to do this in your ",(0,o.kt)("inlineCode",{parentName:"p"},"packages/api/.env")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"packages/cli/.env")," files by assigning a number to the ",(0,o.kt)("inlineCode",{parentName:"p"},"AZURE_CONSUMPTION_CHUNKS_DAYS")," variable."),(0,o.kt)("p",null,"In doing so, this will split the requests into smaller chunks of specified days (i.e. assigning a value of 3 will make a request for every 3 days in the requested date range). When enabled, you will see the following log confirming the chunk size:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-zsh"},"Time range will be requested in chunks of [chunk size] days.\n")),(0,o.kt)("p",null,"...in addition to a similar log for each chunk to indicate the request progress:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-zsh"},"[ConsumptionManagement] debug: Querying consumption usage details from 2023-02-28T00:00:00.000Z to 2023-03-01T23:59:59.999Z\n")),(0,o.kt)("h5",{id:"multiple-subscriptions"},"Multiple Subscriptions"),(0,o.kt)("p",null,"You may use this feature with multiple subscriptions, but when doing so, usage data for each subscription will be requested synchronously. This is because making parallel requests would cause rate limits to be encountered more frequently since the chunked requests would be asynchronously made for each subscription -- thus multiplying the number of requests made to the API."),(0,o.kt)("p",null,"You are welcome to use this option if exceeding rate limits for large requests still pose an issue for you. Just be aware that the synchronous nature of the requests will increase the time it takes to fetch usage data for your subscriptions, in exchange for less rate limits errors and retry attempts."))}d.isMDXComponent=!0}}]);